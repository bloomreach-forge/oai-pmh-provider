<!DOCTYPE html>
    <!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 at 2020-09-14 
 | Rendered using BloomReach Forge Maven Skin 3.1.1 based on Apache Maven Fluido Skin
-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                  <meta name="Date-Revision-yyyymmdd" content="20200914" />
              <meta http-equiv="Content-Language" content="en" />
      <title>Bloomreach OAI-PMH Provider &#x2013; Usage Instructions</title>
  <link rel="stylesheet" href="./css/forge-maven-skin-syntaxhighlighter-3.1.1.min.css"/>
  <link rel="stylesheet" href="./css/forge-maven-skin-3.1.1.min.css"/>
  <link rel="stylesheet" href="./css/site.css" />
  <link rel="stylesheet" href="./css/print.css" media="print" />
  <link rel="icon" type="image/png" href="./images/skin/logo_64.png" sizes="64x64">

  
  <script type="text/javascript" src="./js/forge-maven-skin-syntaxhighlighter-3.1.1.min.js"></script>
  <script type="text/javascript" src="./js/forge-maven-skin-3.1.1.min.js"></script>

    </head>
<body class="topBarDisabled">
                        <a href="https://github.com/bloomreach-forge/oai-pmh-provider">
    <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
         src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
         alt="Fork me on GitHub">
  </a>
          <div class="container-fluid">
  <div id="banner">
    <div id="logo">
                        <a href="https://bloomreach-forge.github.io">
        <img src="./images/skin/logo.png" alt="BloomReach Forge Logo" />
      </a>
    </div>
    <div class="pull-left">              <div id="bannerLeft">    <h1>Bloomreach OAI-PMH Provider</h1>
    </div>
              </div>
    <div class="pull-right"></div>
    <div class="clear"><hr/></div>
  </div>

  <div id="breadcrumbs">
                            <div class="links">
      <a href="https://documentation.bloomreach.com">documentation.bloomreach.com</a>
      <a href="https://developers.bloomreach.com">developers.bloomreach.com</a>
    </div>
    <ul class="breadcrumb">
    
  <li id="publishDate">published: 2020-09-14  
  </li>
  
        
            </ul>
    <div class="clear"><hr/></div>
  </div>
<div class="row-fluid">
  <div id="leftColumn" class="span2">
    <div class="well sidebar-nav">
    
    <ul class="nav nav-list">
            <li class="nav-header">OAI-PMH provider</li>
              <li>  <a href="index.html" title="Introduction">  <span class="none"></span>  Introduction</a>  </li>
        <li class="active">  <a href="#"><span class="none"></span>Usage</a>
  </li>
        <li>  <a href="release-notes.html" title="Release Notes">  <span class="none"></span>  Release Notes</a>  </li>
                  <li class="nav-header">Autogenerated Docs</li>
                                                                                                                                                                                                                        <li>  <a href="project-info.html" title="Project Information">  <span class="icon-chevron-right"></span>  Project Information</a>  </li>
        </ul>
    
          <hr />
      <div id="poweredBy">
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
              <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">  <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />  </a>
          </div>
    </div>
  </div>
  <div id="bodyColumn"  class="span10" >
    
  
    <section>
<h2><a name="Usage"></a>Usage</h2>
      <section>
<h3><a name="Prerequisites"></a>Prerequisites</h3>
        
<p>
          These instructions assume that you have a Hippo project based on the Hippo project archetype, i.e.
          a Maven multiproject consisting of submodules like cms, site and repository-data.
        </p>
        
<p>
          You should know on how to use the
          <a class="externalLink" href="https://documentation.bloomreach.com/library/concepts/rest/restful-jax-rs-component-support-in-hst-2.html">HST RESTful JAX-RS Component Support</a>
        </p>
        
<p>
          You should know how the OAI-PMH protocol works; see the
          <a class="externalLink" href="http://www.openarchives.org/OAI/openarchivesprotocol.html">Protocol for Metadata Harvesting specification</a>
        </p>
      </section>

      <section>
<h3><a name="Installation"></a>Installation</h3>
        
<ol style="list-style-type: decimal">
          
<li>
            
<p>In the main pom.xml of the project, in the repositories section, add this repository if it is not configured there yet.</p>
            
<div class="source"><pre>
              
    &lt;repository&gt;
      &lt;id&gt;hippo-forge&lt;/id&gt;
      &lt;name&gt;Bloomreach Forge maven 2 repository.&lt;/name&gt;
      &lt;url&gt;https://maven.onehippo.com/maven2-forge/&lt;/url&gt;
    &lt;/repository&gt;
            </pre></div>
          </li>
          
<li>
            
<p>Add to the pom.xml of your
              <i>cms</i>
              module:
            </p>
            
<div class="source"><pre>
              
&lt;dependency&gt;
 &lt;groupId&gt;org.bloomreach.forge.oai-pmh-provider&lt;/groupId&gt;
 &lt;artifactId&gt;oai-pmh-provider-repository&lt;/artifactId&gt;
 &lt;version&gt;[version]&lt;/version&gt;
&lt;/dependency&gt;
                        
            </pre></div>
            
<div class="alert alert-info">
              Note: before version 5.0.0, the artifact's groupId was <code>org.onehippo.forge</code>.
            </div>          </li>
          
<li>
            
<p>Add to the pom.xml of your
              <i>site</i>
              module:
            </p>
            
<div class="source"><pre>
              
&lt;dependency&gt;
 &lt;groupId&gt;org.bloomreach.forge.oai-pmh-provider&lt;/groupId&gt;
 &lt;artifactId&gt;oai-pmh-provider-hst&lt;/artifactId&gt;
 &lt;version&gt;[version]&lt;/version&gt;
&lt;/dependency&gt;
                        
            </pre></div>
            
<div class="alert alert-info">
              Note: before version 5.0.0, the artifact's groupId was <code>org.onehippo.forge</code>.
            </div>
          </li>
          
<li>
            
<p>Add to the web.xml of your
              <i>site</i>
              module:
            </p>
            
<div class="source"><pre>
              
&lt;context-param&gt;
    &lt;param-name&gt;hst-beans-annotated-classes&lt;/param-name&gt;
    &lt;param-value&gt;.....,
      classpath*:org/onehippo/forge/oaipmh/provider/api/**/*.class,
    &lt;/param-value&gt;
  &lt;/context-param&gt;
                        
            </pre></div>
          </li>

        </ol>
      </section>

      <section>
<h3><a name="Configure_your_content_beans"></a>Configure your content beans</h3>
        
<p>first implement the org.onehippo.forge.oaipmh.provider.api.OAIBean</p>
        
<p>There are 3 types of annotations you should use in your content beans:</p>
        
<ol style="list-style-type: decimal">
          
<li>@OAI: for setting the setName (on the bean class)</li>
          
<li>@OAIDelegate: for delegating different metadata prefixes (we currently only support &quot;dc_oai&quot; and/or &quot;lom&quot;)</li>
          
<li>@OAIIdentifier: for generating the record identifier</li>
          
<li>
            <a class="externalLink" href="https://github.com/bloomreach-forge/oai-pmh-provider/blob/develop/demo/site/components/src/main/java/org/onehippo/forge/beans/NewsDocument.java">example newsdocument:</a>
          </li>
          
<li>
            <a class="externalLink" href="https://github.com/bloomreach-forge/oai-pmh-provider/blob/develop/demo/site/components/src/main/java/org/onehippo/forge/beans/ContentDocument.java">example contentdocument:</a>
          </li>
        </ol>
      </section>
      <section>
<h3><a name="Make_sure_you_have_the_oai:document_mixin_on_your_document"></a>Make sure you have the oai:document mixin on your document</h3>
        
<p>Either in the CND (example):</p>
        
<div class="source"><pre>
          

&lt;'oaipmh.demo'='http://www.onehippo.org/oaipmh.demo/nt/1.0'&gt;
&lt;'hippo'='http://www.onehippo.org/jcr/hippo/nt/2.0'&gt;
&lt;'hippostd'='http://www.onehippo.org/jcr/hippostd/nt/2.0'&gt;
&lt;'hippostdpubwf'='http://www.onehippo.org/jcr/hippostdpubwf/nt/1.0'&gt;
&lt;'oai'='http://www.hippoecm.org/hst/nt/oai/1.0'&gt;

[oaipmh.demo:basedocument] &gt; hippo:document, hippostd:publishableSummary, hippostdpubwf:document orderable

[oaipmh.demo:contentdocument] &gt; oaipmh.demo:basedocument, hippostd:relaxed

[oaipmh.demo:newsdocument] &gt; oaipmh.demo:basedocument, hippostd:relaxed, oai:document

              
        </pre></div>
        
<p>Or in your prototype (best practice):</p>
        
<div class="source"><pre>
 /hipposysedit:prototype:
  jcr:primaryType: oaipmhdemo:contentdocument
  jcr:mixinTypes: ['mix:referenceable', 'oai:document']
        </pre></div>
        
<p>Depending on your project, you might need to create a script which will add the mixin on all existing documents</p>
      </section>
      <section>
<h3><a name="Add_the_resource_to_the_Custom_Jaxrs_Plain_resource_Pipeline_.28or_to_custom_pipeline.29"></a>Add the resource to the Custom Jaxrs Plain resource Pipeline (or to custom pipeline)</h3>
        
<p>add oai-pmh.xml to META-INF.hst-assembly.overrides package of your site project. Example:</p>
        
<div class="source"><pre>
          
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
     xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
     xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;&gt;

&lt;import resource=&quot;classpath:/org/onehippo/forge/oaipmh/provider/resource/oai-pmh.xml&quot;/&gt;

&lt;bean id=&quot;beanPackage&quot; class=&quot;java.lang.String&quot;&gt;
  &lt;constructor-arg value=&quot;org.onehippo.demo&quot;/&gt;
&lt;/bean&gt;

&lt;bean id=&quot;customRestOAIPMHResourceProviders&quot; class=&quot;org.springframework.beans.factory.config.ListFactoryBean&quot;&gt;
  &lt;property name=&quot;sourceList&quot;&gt;
    &lt;list&gt;
      &lt;bean class=&quot;org.apache.cxf.jaxrs.lifecycle.SingletonResourceProvider&quot;&gt;
        &lt;constructor-arg&gt;
          &lt;bean class=&quot;org.onehippo.demo.rest.OAIPMHResource&quot;&gt;
            &lt;property name=&quot;beansPackage&quot; value=&quot;org.onehippo.beans&quot;/&gt;
            &lt;!--milliseconds setting since versions 3.1.0 and 4.1.0 --&gt;
            &lt;property name=&quot;useMilliSecondsDatePrecision&quot; value=&quot;false&quot;/&gt;
          &lt;/bean&gt;
        &lt;/constructor-arg&gt;
      &lt;/bean&gt;
    &lt;/list&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;/beans&gt;

        </pre></div>
      </section>
      <section>
<h3><a name="Configure_usage_of_milliseconds_date_format"></a>Configure usage of milliseconds date format</h3>
        
<ul>
          
<p>Since versions 3.1.1 and 4.1.1 you can configure using either second or millisecond precision on
            (publication)date (oai:pubdate) and resumption token properties.</p>
          
<p>Second-precision is used by default. To enable the use of millisecond-precision:</p>
          
<p>In oai-pmh.xml in the META-INF.hst-assembly.overrides package of your site project, set:
            </p>
<div class="source"><pre>  &lt;property name=&quot;useMilliSecondsDatePrecision&quot; value=&quot;true&quot;/&gt; </pre></div> 
          
<p>In the console, configure the oaipmh derivative configuration to use the OAIPMHDateFunctionMillis Class:</p>
          
<div class="source"><pre>
            
          definitions:
            config:
              /hippo:configuration/hippo:derivatives/oaipmh:
                hipposys:classname: org.onehippo.forge.oaipmh.repository.deriveddata.OAIPMHDateFunctionMillis
          </pre></div>
          
<p>Documents that are touched by the derivative function will now have millisecond precision properties set. Existing documents will need to be updated using a groovy script.</p>
        </ul>
      </section>
      <section>
<h3><a name="Configure_HST_mount"></a>Configure HST mount</h3>
          
<p>Configure your HST mount to display the correct mount on the URL, e.g.
            <a class="externalLink" href="http://localhost:8080/site/pmh">http://localhost:8080/site/pmh</a>
          </p>
          
<p>Automatically the oai-pmh project will set PMH mount on the hst:root mount</p>
          
<p>Try out the identify verb e.g.
            <a class="externalLink" href="http://localhost:8080/site/pmh/oai?verb=Identify">http://localhost:8080/site/pmh/oai?verb=Identify</a>
          </p>
          
<p>You can configure metadata from the Identify by looking at the mount for the identify.path property
            which points to an Identify document.</p>
      </section>
      <section>
<h3><a name="Test"></a>Test</h3>
        
<li>
          <a class="externalLink" href="http://localhost:8080/site/pmh/oai?verb=Identify">Identify</a>
        </li>
        
<li>
          <a class="externalLink" href="http://localhost:8080/site/pmh/oai?verb=ListRecords&amp;metadataPrefix=oai_dc">List Records (oai_dc)</a>
        </li>
        
<li>
          <a class="externalLink" href="http://localhost:8080/site/pmh/oai?verb=ListRecords&amp;metadataPrefix=lom">List Records (lom : edurep)</a>
        </li>
        
<li>
          <a class="externalLink" href="http://localhost:8080/site/pmh/oai?verb=ListIdentifiers&amp;metadataPrefix=lom">List identifiers (lom : edurep)</a>
        </li>
        
<li>
          <a class="externalLink" href="http://localhost:8080/site/pmh/oai?verb=GetRecord&amp;identifier=c580ac64-3874-4717-a6d9-e5ad72080abe&amp;metadataPrefix=lom">Get Single Record (lom : edurep)</a>
        </li>
        
<li>
          <a class="externalLink" href="http://localhost:8080/site/pmh/oai?verb=ListMetadataFormats">List Metadata formats oai_dc &amp; lom (edurep)</a>
        </li>
        
<li>
          <a class="externalLink" href="http://localhost:8080/site/pmh/oai?verb=ListSets">List Sets</a>
        </li>
      </section>
      <section>
<h3><a name="EDUREP_NLLOM"></a>EDUREP NLLOM</h3>
        
<p>Important for EDUREP!!</p>
        
<p>You should have the knowledge about the used xml formats and which elements and attributes are mandatory for edurep NLLOM</p>
        
<p>
          <a class="externalLink" href="https://wiki.surfnet.nl/display/nllom/Home">https://wiki.surfnet.nl/display/nllom/Home</a>
        </p>
        
<p>All elements and attributes are already provided in the oai-pmh project under the following package: <a class="externalLink" href="https://github.com/bloomreach-forge/oai-pmh-provider/tree/master/hst/src/main/java/org/onehippo/forge/oaipmh/provider/model/oai/edurep/lom/"> package</a></p>
        
<p>Plus we also provide a helper class which should get you going: <a class="externalLink" href="https://github.com/bloomreach-forge/oai-pmh-provider/tree/master/hst/src/main/java/org/onehippo/forge/oaipmh/provider/model/oai/edurep/lom/NLLom.java">NLLOM</a> in combination with
          <a class="externalLink" href="https://github.com/bloomreach-forge/oai-pmh-provider/tree/master/demo/site/src/main/java/org/onehippo/forge/oaipmh/beans/NewsDocument.java"> newsdocument:</a></p>
        
<p>Be aware you probably need to check your own metadata configuration for mandatory elements and properties</p>
      </section>
    </section>

  

    </div>
    </div>
    </div>
    <hr/>
    <footer>
    <div class="container-fluid">
      <div class="row-fluid">
          <p class="copyright">Copyright &copy;      2011&#x2013;2020
                    <a href="https://www.bloomreach.com">BloomReach Inc.</a>.
              
</p>
    </div>
            </div>
  </footer>
    </body>
</html>

